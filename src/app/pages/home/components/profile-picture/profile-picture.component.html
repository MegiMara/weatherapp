<div class="weather-app profile-container">
  <!-- Header -->
  <div class="profile-header">
    <button class="back-button" (click)="router.navigate(['/home'])" type="button">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M19 12H5"></path>
        <polyline points="12,19 5,12 12,5"></polyline>
      </svg>
      Back to Home
    </button>
    <h1 class="page-title">User Profile</h1>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && userProfile" class="profile-content">

    <!-- ===== View Mode ===== -->
    <div *ngIf="!isEditing" class="profile-view">
      <div class="profile-card">
        <!-- Avatar -->
        <div class="avatar-section">
          <div class="avatar-container">
            <img *ngIf="avatarPreview" [src]="avatarPreview" [alt]="userProfile.name" class="avatar-image"/>
            <div *ngIf="!avatarPreview" class="avatar-placeholder">{{ getInitials() }}</div>
          </div>
        </div>

        <!-- User Info -->
        <div class="user-info">
          <h2 class="user-name">{{ userProfile.name }}</h2>
          <p class="user-email">{{ userProfile.email }}</p>
        </div>

        <!-- Action Buttons -->
        <div class="profile-actions">
          <button class="btn btn-primary" (click)="toggleEdit()" type="button">
            Edit Profile
          </button>
          <button class="btn btn-secondary" (click)="logout()" type="button">
            Logout
          </button>
        </div>
      </div>

      <!-- Favorites -->
      <div *ngIf="(userProfile.favoritesCities || []).length > 0" class="favorites-summary">
        <h3>Favorite Cities</h3>
        <p>You have {{ userProfile.favoritesCities.length }} favorite cities</p>
        <button class="btn btn-outline" (click)="router.navigate(['/favorites'])" type="button">
          View Favorites
        </button>
      </div>
    </div>

    <!-- ===== Edit Mode ===== -->
    <div *ngIf="isEditing" class="profile-edit">
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="edit-form">
        
        <!-- Error / Success Messages -->
        <div *ngIf="error" class="alert error-alert">{{ error }}</div>
        <div *ngIf="success" class="alert success-alert">{{ success }}</div>

        <!-- Avatar Upload -->
        <div class="avatar-upload-section">
          <div class="current-avatar">
            <img *ngIf="avatarPreview" [src]="avatarPreview" [alt]="userProfile.name" class="avatar-image"/>
            <div *ngIf="!avatarPreview" class="avatar-placeholder">{{ getInitials() }}</div>
          </div>
          <div class="avatar-actions">
            <label for="avatar-upload" class="upload-button">Change Photo</label>
            <input type="file" id="avatar-upload" accept="image/*" (change)="onAvatarChange($event)" class="file-input"/>
            <button *ngIf="selectedAvatarFile" type="button" class="remove-button" (click)="removeAvatar()">Remove</button>
          </div>
        </div>

        <!-- Form Fields -->
        <div class="form-fields">
          <div class="form-group">
            <label for="name">Full Name *</label>
            <input type="text" id="name" formControlName="name" class="form-input"
                   [class.error]="profileForm.get('name')?.invalid && profileForm.get('name')?.touched"/>
            <div *ngIf="profileForm.get('name')?.invalid && profileForm.get('name')?.touched" class="error-message">
              <span *ngIf="profileForm.get('name')?.errors?.['required']">Name is required.</span>
              <span *ngIf="profileForm.get('name')?.errors?.['minlength']">Name must be at least 2 characters.</span>
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email Address *</label>
            <input type="email" id="email" formControlName="email" class="form-input"
                   [class.error]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"/>
            <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" class="error-message">
              <span *ngIf="profileForm.get('email')?.errors?.['required']">Email is required.</span>
              <span *ngIf="profileForm.get('email')?.errors?.['email']">Enter a valid email address.</span>
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password (optional)</label>
            <input type="password" id="password" formControlName="password" class="form-input"/>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="profileForm.invalid || isSaving">
            <span *ngIf="!isSaving">Save Changes</span>
            <span *ngIf="isSaving" class="saving-state">Saving...</span>
          </button>
        </div>
      </form>
    </div>

  </div>
</div>








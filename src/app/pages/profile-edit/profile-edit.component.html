<div class="weather-app profile-edit-container">
  <div class="profile-edit-wrapper">
    <!-- Header -->
    <div class="profile-header">
      <button class="back-button" (click)="cancel()" type="button">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M19 12H5"></path>
          <polyline points="12,19 5,12 12,5"></polyline>
        </svg>
        Back to Home
      </button>
      <h1 class="page-title">Edit Profile</h1>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading profile data...</p>
    </div>

    <!-- Profile Edit Form -->
    <div *ngIf="!isLoading" class="profile-form-container">
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
        
        <!-- Avatar Section -->
        <div class="avatar-section">
          <div class="avatar-container">
            <div class="current-avatar">
              <img 
                *ngIf="avatarPreview" 
                [src]="avatarPreview" 
                [alt]="userProfile?.name || 'User avatar'"
                class="avatar-image"
              />
              <div 
                *ngIf="!avatarPreview" 
                class="avatar-placeholder"
              >
                {{ getInitials() }}
              </div>
            </div>
            
            <div class="avatar-actions">
              <label for="avatar-upload" class="upload-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91-6.91a2.12 2.12 0 0 1 0-3l2.83-2.83a2.12 2.12 0 0 1 3 0l.13.13"></path>
                  <path d="M16 8L2 22"></path>
                  <path d="M17.5 15H9"></path>
                </svg>
                Change Photo
              </label>
              <input 
                type="file" 
                id="avatar-upload" 
                accept="image/*" 
                (change)="onAvatarChange($event)"
                class="file-input"
              />
              
              <button 
                *ngIf="selectedAvatarFile" 
                type="button" 
                class="remove-button"
                (click)="removeAvatar()"
              >
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
                Remove
              </button>
            </div>
          </div>
          
          <div class="avatar-info">
            <h3>Profile Picture</h3>
            <p>Upload a photo to personalize your profile. Max size: 5MB</p>
          </div>
        </div>

        <!-- Form Fields -->
        <div class="form-section">
          <h3>Personal Information</h3>
          
          <!-- Name Field -->
          <div class="form-group">
            <label for="name" class="form-label">
              Full Name *
            </label>
            <input 
              type="text" 
              id="name"
              formControlName="name"
              class="form-input"
              placeholder="Enter your full name"
              [class.error]="profileForm.get('name')?.invalid && profileForm.get('name')?.touched"
            />
            <div 
              *ngIf="profileForm.get('name')?.invalid && profileForm.get('name')?.touched" 
              class="error-message"
            >
              <span *ngIf="profileForm.get('name')?.errors?.['required']">Name is required</span>
              <span *ngIf="profileForm.get('name')?.errors?.['minlength']">Name must be at least 2 characters</span>
            </div>
          </div>

          <!-- Email Field -->
          <div class="form-group">
            <label for="email" class="form-label">
              Email Address *
            </label>
            <input 
              type="email" 
              id="email"
              formControlName="email"
              class="form-input"
              placeholder="Enter your email address"
              [class.error]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"
            />
            <div 
              *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" 
              class="error-message"
            >
              <span *ngIf="profileForm.get('email')?.errors?.['required']">Email is required</span>
              <span *ngIf="profileForm.get('email')?.errors?.['email']">Please enter a valid email</span>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="error" class="alert error-alert">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          <span>{{ error }}</span>
        </div>

        <!-- Success Message -->
        <div *ngIf="success" class="alert success-alert">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <polyline points="20,6 9,17 4,12"></polyline>
          </svg>
          <span>{{ success }}</span>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="cancel()"
            [disabled]="isSaving"
          >
            Cancel
          </button>
          
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="profileForm.invalid || isSaving"
          >
            <span *ngIf="!isSaving">Save Changes</span>
            <span *ngIf="isSaving" class="saving-state">
              <div class="button-spinner"></div>
              Saving...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>